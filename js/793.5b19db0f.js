(self["webpackChunkhorario"]=self["webpackChunkhorario"]||[]).push([[793],{5793:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return w}});var i=o(7179),a=o(3058),s=o(5223),r=o(4437),n=o(6035),l=o(9531),c=o(5452),u=o(5057),d=o(4544),h=o(5234),m=o(5617),f=o(1002),p=o(2370),g=function(){var e=this,t=e._self._c;return t(n.Z,{directives:[{name:"show",rawName:"v-show",value:null!=e.linhasTurnoSelecionado&&e.linhasTurnoSelecionado.length,expression:"linhasTurnoSelecionado != null && linhasTurnoSelecionado.length"}],staticStyle:{padding:"0"},attrs:{fluid:""}},[t(c.Z,{model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t("informacoes-horario",{attrs:{"id-horario":e.$store.state.selectedSchedule}})],1),t(c.Z,{staticClass:"mx-auto mt-5",attrs:{persistent:"","max-width":"1000px"},model:{value:e.observationDialog,callback:function(t){e.observationDialog=t},expression:"observationDialog"}},[t(a.Z,[t(f.Z,{attrs:{flat:""}},[t(p.qW,[e._v("Observações")])],1),t(s.ZB,[t(m.Z,{attrs:{label:"Observações","auto-grow":"",clearable:"",rows:"1",spellcheck:"false"},model:{value:e.observacao,callback:function(t){e.observacao=t},expression:"observacao"}})],1),t(s.h7,[t(h.Z),t(i.Z,{attrs:{color:"red darken-1",text:""},on:{click:function(t){e.observationDialog=!1}}},[e._v("Cancelar")]),t(i.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.saveObservation}},[e._v("Salvar")]),t(h.Z)],1)],1)],1),null!=e.$store.state.selectedSchedule?t(l.Z,{staticClass:"tabela",attrs:{headers:e.headers,items:e.linhasTurnoSelecionado,"hide-default-footer":!0,"disable-pagination":"","disable-filtering":"","disable-sort":"",dense:"",loading:e.loading,"no-data-text":"Não foi possível obter a grade horária","loading-text":"Carregando"},scopedSlots:e._u([{key:"top",fn:function(){return[t(f.Z,{attrs:{flat:"",dense:""}},[t(u.Z,{staticStyle:{cursor:"all-scroll"},attrs:{large:""},on:{mousedown:function(t){return e.$emit("resize",t)}}},[e._v("mdi-drag ")]),t(p.qW,[e._v("Horário "+e._s(null!=e.$store.state.selectedSchedule?`(${e.$store.state.selectedSchedule})`:null))]),null!=e.$store.state.selectedSchedule?[t(i.Z,{attrs:{color:"primary",icon:""},on:{click:e.previousSchedule}},[t(u.Z,[e._v("mdi-chevron-left")])],1),t(i.Z,{attrs:{color:"primary",icon:""},on:{click:e.nextSchedule}},[t(u.Z,[e._v("mdi-chevron-right")])],1),t(i.Z,{attrs:{color:"primary",icon:""},on:{click:e.exportSchedule}},[t(u.Z,[e._v("mdi-download")])],1),null!=e.hardCost&&0!==e.hardCost?t(i.Z,{attrs:{color:"red",icon:""},on:{click:function(t){e.dialog=!0}}},[t(u.Z,[e._v("mdi-alert")])],1):t(i.Z,{attrs:{color:"primary",icon:""},on:{click:function(t){e.dialog=!0}}},[t(u.Z,[e._v("mdi-information")])],1),t(i.Z,{attrs:{color:null==e.observacao?"primary":"red lighten-1",icon:""},on:{click:function(t){e.observationDialog=!0}}},[t(u.Z,[e._v("mdi-comment")])],1)]:e._e(),t(h.Z),t(r.Z,{attrs:{cols:"3"}},[null!=e.turnos&&e.turnos.length>1?t(d.Z,{attrs:{items:e.turnos,"item-text":"name","item-value":"id"},model:{value:e.turnoSelecionado,callback:function(t){e.turnoSelecionado=t},expression:"turnoSelecionado"}}):e._e()],1)],2)]},proxy:!0},{key:"item",fn:function(o){return[t("tr",[1===o.item.aula?t("td",{staticClass:"vertical-text",style:{"border-top":1===o.item.aula&&o.item.index_aula<e.aulasPorDiaTurnoSelecionado*(e.numero_dias-1)?"1px solid black !important":"thin solid rgba(0, 0, 0, 0.12) !important"},attrs:{rowspan:e.aulasPorDiaTurnoSelecionado}},[e._v(" "+e._s(e.diasSemana[Math.floor(o.item.index_aula/e.aulasPorDiaTurnoSelecionado)].name)+" ")]):e._e(),t("td",{style:{"border-bottom":o.item.aula===e.aulasPorDiaTurnoSelecionado&&o.item.index_aula+1<e.aulasPorDiaTurnoSelecionado*e.numero_dias?"1px solid black !important":"thin solid rgba(0, 0, 0, 0.12)","border-right":"thin solid rgba(0, 0, 0, 0.12)"}},[t(u.Z,{attrs:{medium:""}},[e._v(e._s("mdi-numeric-"+o.item.aula))]),e.conflictRows.has(o.item.aula)?t(u.Z,{attrs:{small:""}},[e._v("mdi-alert")]):e._e(),e.freePeriodsRows.has(o.item.index_aula)?t(u.Z,{attrs:{small:""},on:{click:function(t){return e.handleFreePeriodClick(o.item.index_aula)}}},[e._v("mdi-clock")]):e._e()],1),e._l(e.salasTurnoSelecionado,(function(i,a){return[t("td",{key:2*a,style:{color:o.item[i.id]===e.focusedTeacher||e.highlightPositions.has(o.item.index_aula+"-"+i.id)?e.backgroundColor:e.colorLookup[o.item[i.id]],background:o.item[i.id]===e.focusedTeacher||e.highlightPositions.has(o.item.index_aula+"-"+i.id)?e.colorLookup[o.item[i.id]]:e.backgroundColor,"border-bottom":o.item.aula===e.aulasPorDiaTurnoSelecionado&&o.item.index_aula+1<e.aulasPorDiaTurnoSelecionado*e.numero_dias?"1px solid black !important":"thin solid rgba(0, 0, 0, 0.12)","border-left":"thin solid black !important",cursor:"pointer"},on:{click:function(t){return e.focusTeacher(o.item[i.id])}}},[o.item[i.id]>=0?t("span",[e._v(e._s(e.professoresLookup[o.item[i.id]]))]):e._e()]),t("td",{key:2*a+1,style:{color:o.item[i.id]===e.focusedTeacher||o.item["M"+i.id]===e.focusedSubject||e.highlightPositions.has(o.item.index_aula+"-"+i.id)?e.backgroundColor:e.colorLookup[o.item[i.id]],background:o.item[i.id]===e.focusedTeacher||o.item["M"+i.id]===e.focusedSubject||e.highlightPositions.has(o.item.index_aula+"-"+i.id)?e.colorLookup[o.item[i.id]]:e.backgroundColor,"border-bottom":o.item.aula===e.aulasPorDiaTurnoSelecionado&&o.item.index_aula+1<e.aulasPorDiaTurnoSelecionado*e.numero_dias?"1px solid black !important":"thin solid rgba(0, 0, 0, 0.12)",cursor:"pointer"},on:{click:function(t){return e.focusSubject(o.item["M"+i.id])}}},[null!=o.item["M"+i.id]?t("span",[e._v(e._s(e.materiasLookup[o.item["M"+i.id]]))]):e._e()])]}))],2)]}}],null,!1,2882454458)}):e._e()],1)},b=[],v=(o(6314),o(6125)),S={name:"TabelaHorario",props:["id"],mixins:[v.Z],components:{InformacoesHorario:()=>o.e(669).then(o.bind(o,7669))},data(){return{linhas:{},turnos:[],salas:[],focusedTeacher:null,focusedSubject:null,conflictRows:new Set,freePeriodsRows:new Set,freePeriodsStats:{},highlightPositions:new Set,interval:null,dialog:!1,observationDialog:!1,hardCost:null,loading:!1,observacao:null}},computed:{headers(){let e=[{text:"Dia",align:"center",width:"10px"},{text:"Aula",value:"aula",align:"center",width:"100px"}];return this.salas.filter((e=>e.turno===this.turnoSelecionado)).forEach((t=>{e.push({text:t.name,value:t.id}),e.push({value:"M"+t.id})})),e},professoresLookup(){const e=Array.from(this.professores,(e=>[e.id,e.name]));return Object.fromEntries(e)},linhasTurnoSelecionado(){return this.linhas&&null!=this.turnoSelecionado&&Object.hasOwn(this.linhas,this.turnoSelecionado)?this.linhas[this.turnoSelecionado]:[]},colorLookup(){const e=this.professores.length,t=Array.from(this.professores,((t,o)=>[t.id,this.cappedBrightnessHSL(o/e,1,.5,200)]));return Object.fromEntries(t)},salasTurnoSelecionado(){return this.salas.filter((e=>e.turno===this.turnoSelecionado))},backgroundColor(){return this.$vuetify.theme.dark?"#1E1E1E":"#FFFFFF"}},watch:{"$store.state.selectedSchedule":{handler:function(e){null!=e&&this.load()}},turnos(e){e&&!this.turnoSelecionado&&(this.turnoSelecionado=e[0].id)},turnoSelecionado(e){null!=e&&(this.getConflictRows(),this.getFreePeriodsRows())}},mounted(){this.load()},methods:{async load(){try{if(null==this.$store.state.selectedSchedule)return;this.loading=!0,await this.getStructure();const e=await this.$axios.post("/horario",{id_horario:this.$store.state.selectedSchedule,id_configuracao:this.id});if(this.observacao=e.data.observacao,null==e.data.hardCost)return void this.$store.dispatch("setSelectedSchedule",null);this.linhas=e.data.horario,this.hardCost=e.data.hardCost,this.getConflictRows(),this.getFreePeriodsRows()}catch(e){console.error(e)}finally{this.loading=!1}},async exportSchedule(){const e=await this.$axios.get("/horario/exportar",{params:{id_horario:this.$store.state.selectedSchedule,id_configuracao:this.id},responseType:"blob"}),t=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=document.createElement("a");o.href=URL.createObjectURL(t),o.click(),URL.revokeObjectURL(o.href)},cappedBrightnessHSL(e,t,o,i){const a=this.hslToRgb(e,t,o),s=this.perceivedBrightness(a);return s>i&&(o*=.8),this.hsl(e,t,o)},hsl:(e,t,o)=>`hsl(${360*e|0},${100*t}%,${100*o}%)`,hslToRgb(e,t,o){let i,a,s;if(0===t)i=a=s=o;else{const r=o<.5?o*(1+t):o+t-o*t,n=2*o-r;i=this.hueToRgb(n,r,e+1/3),a=this.hueToRgb(n,r,e),s=this.hueToRgb(n,r,e-1/3)}return[Math.round(255*i),Math.round(255*a),Math.round(255*s)]},hueToRgb(e,t,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?e+6*(t-e)*o:o<.5?t:o<2/3?e+(t-e)*(2/3-o)*6:e},perceivedBrightness(e){const[t,o,i]=e;return.2126*t+.7152*o+.0722*i},getConflictRows(){const e=new Set;for(let t=0;t<this.linhasTurnoSelecionado.length;t++){const o=this.linhasTurnoSelecionado[t],i=Object.create(null);for(const a of Object.keys(o))if("aula"!==a&&"id_turno"!==a&&!a.includes("M")&&"index_aula"!==a&&null!=o[a]){if(o[a]in i){e.add(t);break}i[o[a]]=null}}this.conflictRows=e},handleFreePeriodClick(e){const t=new Set;for(const o of this.freePeriodsStats[e]){const{topBorder:e,bottomBorder:i,topClasses:a,bottomClasses:s}=o;a.forEach((o=>{t.add(e+"-"+o)})),s.forEach((e=>{t.add(i+"-"+e)}))}this.highlightPositions=t,this.focusedTeacher=null},focusTeacher(e){this.focusedTeacher=e,this.focusedSubject=null,this.highlightPositions.clear()},focusSubject(e){this.focusedSubject=e,this.focusedTeacher=null,this.highlightPositions.clear()},getFreePeriodsRows(){const e=new Set,t={};function o(e,t){for(const o of Object.keys(e))if("aula"!==o&&"id_turno"!==o&&"index_aula"!==o&&null!=e[o]&&e[o]===t)return!0;return!1}function i(e,t){const o=[];for(const i of Object.keys(e))"aula"!==i&&"id_turno"!==i&&"index_aula"!==i&&null!=e[i]&&e[i]===t&&o.push(i);return o}for(const a of this.professores){const s=a.id;let r=null;for(let a=0;a<this.linhasTurnoSelecionado.length;a++)if(a%this.aulasPorDiaTurnoSelecionado===0&&(r=null),o(this.linhasTurnoSelecionado[a],s))if(null===r||r===a-1)r=a;else{const o=i(this.linhasTurnoSelecionado[r],s),n=i(this.linhasTurnoSelecionado[a],s);for(let i=r+1;i<a;i++)e.add(i),i in t||(t[i]=[]),t[i].push({topBorder:r,bottomBorder:a,topClasses:o,bottomClasses:n});r=a}}this.freePeriodsRows=e,this.freePeriodsStats=t},nextSchedule(){this.$emit("next-schedule")},previousSchedule(){this.$emit("prev-schedule")},async saveObservation(){await this.$axios.post("/horario/obs",{id_horario:this.$store.state.selectedSchedule,id_configuracao:this.id,observacao:null!=this.observacao&&this.observacao.length>0?this.observacao.trim():null}),this.load(),this.observationDialog=!1,this.$emit("reload")}}},k=S,x=o(3736),_=(0,x.Z)(k,g,b,!1,null,"6f6a0432",null),w=_.exports},5617:function(e,t,o){"use strict";o.d(t,{Z:function(){return r}});var i=o(5251),a=o(4987);const s=(0,a.Z)(i.Z);var r=s.extend({name:"v-textarea",props:{autoGrow:Boolean,noResize:Boolean,rowHeight:{type:[Number,String],default:24,validator:e=>!isNaN(parseFloat(e))},rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseInt(e,10))}},computed:{classes(){return{"v-textarea":!0,"v-textarea--auto-grow":this.autoGrow,"v-textarea--no-resize":this.noResizeHandle,...i.Z.options.computed.classes.call(this)}},noResizeHandle(){return this.noResize||this.autoGrow}},watch:{autoGrow(e){this.$nextTick((()=>{var t;e?this.calculateInputHeight():null===(t=this.$refs.input)||void 0===t||t.style.removeProperty("height")}))},lazyValue(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)},rowHeight(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)}},mounted(){setTimeout((()=>{this.autoGrow&&this.calculateInputHeight()}),0)},methods:{calculateInputHeight(){const e=this.$refs.input;if(!e)return;e.style.height="0";const t=e.scrollHeight,o=parseInt(this.rows,10)*parseFloat(this.rowHeight);e.style.height=Math.max(o,t)+"px"},genInput(){const e=i.Z.options.methods.genInput.call(this);return e.tag="textarea",delete e.data.attrs.type,e.data.attrs.rows=this.rows,e},onInput(e){i.Z.options.methods.onInput.call(this,e),this.autoGrow&&this.calculateInputHeight()},onKeyDown(e){this.isFocused&&13===e.keyCode&&e.stopPropagation(),this.$emit("keydown",e)}}})},6314:function(e,t,o){var i=o(2109),a=o(2597);i({target:"Object",stat:!0},{hasOwn:a})}}]);
//# sourceMappingURL=793.5b19db0f.js.map